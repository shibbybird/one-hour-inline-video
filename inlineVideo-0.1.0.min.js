/*! one-hour-inline-video - 0.1.0 - 2f95bca - 2014-08-18 */
var _MOJO={},MOJO={};_MOJO.Shared=function(a,b){function c(a){return a.length}function d(b){return a.keys(b)}function e(a){return b.prototype.shift.call(a)}function f(a){return a instanceof b?a:a!==i?[a]:[]}function g(a,b){return{get:a,set:b,configurable:!0}}function h(a){return(a||{})[j]?a[j]:a}var i,j="handleMOJO";return{length:c,keys:d,shift:e,ensureArray:f,descriptor:g,getHandlerFunc:h}}(Object,Array),_MOJO.EventHandler=function(a){function b(a,b,c){var e=this;e.handler=a,e.context=b,e.active=!0,e.callback=function(){},e.args=d(c)}var c=a.Shared,d=c.ensureArray;return b.prototype={invoke:function(a,b){var c=this,e=c.handler;if(c.active&&!a.isBreak&&!a.shouldSkip(e)){var f=c.args.concat(d(b));f.unshift(a),e.apply(c.context,f),c.callback(a,e)}}},b}(_MOJO),_MOJO.Event=function(a,b){function c(b,c){var d=this;d.isBreak=e,d.cancelBubble=e,d.defaultPrevented=e,d.skipHandlers=[],d.target=b,d.type=c,d.timeStamp=a.now()}var d=!0,e=!1,f=b.Shared,g=f.ensureArray,h=f.getHandlerFunc;return c.prototype={skip:function(a){var b=this.skipHandlers;g(a).forEach(function(a){b.push(h(a))})},shouldSkip:function(a){return this.skipHandlers.indexOf(a)>=0},"break":function(){this.isBreak=d},preventDefault:function(){this.defaultPrevented=d},stopPropagation:function(){this.cancelBubble=d}},c}(Date,_MOJO),_MOJO.When=function(a,b,c){function d(a,b){return l(a).map(function(a){return a.handler}).indexOf(b)}function e(a,c){(a instanceof b?a:a.split(" ")).forEach(c)}function f(a,b){return a===b?null:a}var g=c.Shared,h=c.EventHandler,i=c.Event,j=g.keys,k=g.shift,l=g.ensureArray,m=g.length,n=g.getHandlerFunc,o={once:function(){var a=this,b=a._when(arguments);return b.forEach(function(a){a.callback=function(){this.active=!1}}),a},when:function(){var a=this;return a._when(arguments),a},_when:function(a){var b=this,c=k(a),d=m(a)>1?k(a):d,g=[],i=k(a),j=n(i),l=f(i,j);return e(c,function(a,c){g.push(new h(j,l,d)),b._addHandler(a,g[c])}),g},happen:function(a,b){var c=this;return a=c._ensureEType(a),e(a,function(a){var d=c._getHandlers(a,!0),e=new i(c,a);d.filter(function(a){return a.invoke(e,b),!a.active}).forEach(function(b){c._removeHandler(c._getHandlers(a),b.handler)})}),c},dispel:function(a,b){var c=this,d=c._getHandlers(),f=n(b);return a=c._ensureEType(a),e(a,function(a){f?c._removeHandler(d[a],f):delete d[a]}),c},_ensureEType:function(a){return a||j(this._getHandlers()).join(" ")},_getHandlers:function(b,c){var d=this,e=d.handlers=d.handlers||{},f=b?e[b]=e[b]||[]:e;return c?b?f.slice():a.create(f):f},_addHandler:function(a,b){var c=this;c._getHandlers(a).push(b)},_removeHandler:function(a,b){var c=d(a,b);c>=0&&a.splice(c,1)}};return o}(Object,Array,_MOJO),MOJO=function(a){function b(a){a=a||{};var c=this;b.Each(a,function(a,b){c[b]=a}),b.Construct(c)}var c=b.prototype=Object.create(a.When);return c.each=function(a){var c=this;return b.Each(c,a,c.keys),c},c.set=function(a,b){var c=this;return c[a]=b,c.happen("set",a),c},c.remove=function(a){var b=this;return delete b[a],b.happen("remove",a),b},b}(_MOJO),MOJO.Each=function(a){function b(a,b,c){(c||d(a)).forEach(function(c,d){b(a[c],c,d)})}var c=a.Shared,d=c.keys;return b}(_MOJO),MOJO.Create=function(a,b){function c(c){var d=a.create(b.prototype);return b.Each(c,function(a,b){d[b]=a}),d}return c}(Object,MOJO),MOJO.Construct=function(a,b){function c(b){var c={};a.defineProperties(b,{handlers:f(function(){return c}),keys:f(function(){return e(b)}),length:f(function(){return g(b.keys)}),handleMOJO:{value:(b.handleMOJO||function(){}).bind(b),configurable:!0}})}var d=b.Shared,e=d.keys,f=d.descriptor,g=d.length;return c}(Object,_MOJO),function(a){"object"==typeof exports?module.exports=a:window.MOJO=a}(MOJO),!function(){var a,b,c,d;!function(){var e={},f={};a=function(a,b,c){e[a]={deps:b,callback:c}},d=c=b=function(a){function c(b){if("."!==b.charAt(0))return b;for(var c=b.split("/"),d=a.split("/").slice(0,-1),e=0,f=c.length;f>e;e++){var g=c[e];if(".."===g)d.pop();else{if("."===g)continue;d.push(g)}}return d.join("/")}if(d._eak_seen=e,f[a])return f[a];if(f[a]={},!e[a])throw new Error("Could not find module "+a);for(var g,h=e[a],i=h.deps,j=h.callback,k=[],l=0,m=i.length;m>l;l++)k.push("exports"===i[l]?g={}:b(c(i[l])));var n=j.apply(this,k);return f[a]=g||n}}(),a("promise/all",["./utils","exports"],function(a,b){"use strict";function c(a){var b=this;if(!d(a))throw new TypeError("You must pass an array to all.");return new b(function(b,c){function d(a){return function(b){f(a,b)}}function f(a,c){h[a]=c,0===--i&&b(h)}var g,h=[],i=a.length;0===i&&b([]);for(var j=0;j<a.length;j++)g=a[j],g&&e(g.then)?g.then(d(j),c):f(j,g)})}var d=a.isArray,e=a.isFunction;b.all=c}),a("promise/asap",["exports"],function(a){"use strict";function b(){return function(){process.nextTick(e)}}function c(){var a=0,b=new i(e),c=document.createTextNode("");return b.observe(c,{characterData:!0}),function(){c.data=a=++a%2}}function d(){return function(){j.setTimeout(e,1)}}function e(){for(var a=0;a<k.length;a++){var b=k[a],c=b[0],d=b[1];c(d)}k=[]}function f(a,b){var c=k.push([a,b]);1===c&&g()}var g,h="undefined"!=typeof window?window:{},i=h.MutationObserver||h.WebKitMutationObserver,j="undefined"!=typeof global?global:void 0===this?window:this,k=[];g="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?b():i?c():d(),a.asap=f}),a("promise/config",["exports"],function(a){"use strict";function b(a,b){return 2!==arguments.length?c[a]:void(c[a]=b)}var c={instrument:!1};a.config=c,a.configure=b}),a("promise/polyfill",["./promise","./utils","exports"],function(a,b,c){"use strict";function d(){var a;a="undefined"!=typeof global?global:"undefined"!=typeof window&&window.document?window:self;var b="Promise"in a&&"resolve"in a.Promise&&"reject"in a.Promise&&"all"in a.Promise&&"race"in a.Promise&&function(){var b;return new a.Promise(function(a){b=a}),f(b)}();b||(a.Promise=e)}var e=a.Promise,f=b.isFunction;c.polyfill=d}),a("promise/promise",["./config","./utils","./all","./race","./resolve","./reject","./asap","exports"],function(a,b,c,d,e,f,g,h){"use strict";function i(a){if(!v(a))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof i))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=[],j(a,this)}function j(a,b){function c(a){o(b,a)}function d(a){q(b,a)}try{a(c,d)}catch(e){d(e)}}function k(a,b,c,d){var e,f,g,h,i=v(c);if(i)try{e=c(d),g=!0}catch(j){h=!0,f=j}else e=d,g=!0;n(b,e)||(i&&g?o(b,e):h?q(b,f):a===D?o(b,e):a===E&&q(b,e))}function l(a,b,c,d){var e=a._subscribers,f=e.length;e[f]=b,e[f+D]=c,e[f+E]=d}function m(a,b){for(var c,d,e=a._subscribers,f=a._detail,g=0;g<e.length;g+=3)c=e[g],d=e[g+b],k(b,c,d,f);a._subscribers=null}function n(a,b){var c,d=null;try{if(a===b)throw new TypeError("A promises callback cannot return that same promise.");if(u(b)&&(d=b.then,v(d)))return d.call(b,function(d){return c?!0:(c=!0,void(b!==d?o(a,d):p(a,d)))},function(b){return c?!0:(c=!0,void q(a,b))}),!0}catch(e){return c?!0:(q(a,e),!0)}return!1}function o(a,b){a===b?p(a,b):n(a,b)||p(a,b)}function p(a,b){a._state===B&&(a._state=C,a._detail=b,t.async(r,a))}function q(a,b){a._state===B&&(a._state=C,a._detail=b,t.async(s,a))}function r(a){m(a,a._state=D)}function s(a){m(a,a._state=E)}var t=a.config,u=(a.configure,b.objectOrFunction),v=b.isFunction,w=(b.now,c.all),x=d.race,y=e.resolve,z=f.reject,A=g.asap;t.async=A;var B=void 0,C=0,D=1,E=2;i.prototype={constructor:i,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(a,b){var c=this,d=new this.constructor(function(){});if(this._state){var e=arguments;t.async(function(){k(c._state,d,e[c._state-1],c._detail)})}else l(this,d,a,b);return d},"catch":function(a){return this.then(null,a)}},i.all=w,i.race=x,i.resolve=y,i.reject=z,h.Promise=i}),a("promise/race",["./utils","exports"],function(a,b){"use strict";function c(a){var b=this;if(!d(a))throw new TypeError("You must pass an array to race.");return new b(function(b,c){for(var d,e=0;e<a.length;e++)d=a[e],d&&"function"==typeof d.then?d.then(b,c):b(d)})}var d=a.isArray;b.race=c}),a("promise/reject",["exports"],function(a){"use strict";function b(a){var b=this;return new b(function(b,c){c(a)})}a.reject=b}),a("promise/resolve",["exports"],function(a){"use strict";function b(a){if(a&&"object"==typeof a&&a.constructor===this)return a;var b=this;return new b(function(b){b(a)})}a.resolve=b}),a("promise/utils",["exports"],function(a){"use strict";function b(a){return c(a)||"object"==typeof a&&null!==a}function c(a){return"function"==typeof a}function d(a){return"[object Array]"===Object.prototype.toString.call(a)}var e=Date.now||function(){return(new Date).getTime()};a.objectOrFunction=b,a.isFunction=c,a.isArray=d,a.now=e}),b("promise/polyfill").polyfill()}(),window.requestAnimationFrame=function(a,b,c,d){function e(){return b.now()-g}var f="equestAnimationFrame",g=b.now();return(a["r"+f]||a["webkitR"+f]||a["mozR"+f]||a["oR"+f]||a["msR"+f]||function(a){var b=c(function(){a(e()),d(b)},1e3/60)}).bind(null)}(window,Date,setTimeout,clearTimeout),window.InlineVideo=function(a,b,c){function d(){return[o,m,k]}function e(b,d){d=d||{};var e=this;e.index=0,e.frameProgress=0,e.queue=[],e.duration=null,e.playing=!1,e[l]=0;var f={min:2};c.Construct(e),a.defineProperties(e,{queueLength:{get:function(){return a.keys(e.queue).length}},elapsed:{get:function(){return Math.round(1e3*(e.index+e.frameProgress))}}}),e.load(d.url,f),e._init(b,d)}function f(a,c){var d=b.createElement("canvas");return d.width=a,d.height=c,d}var g,h,i,j=["not ready","buffering","ready","loaded"],k="coreProgress",l="readyState",m="videoEnd",n="buffer",o="set",p="tic";return e.Init=function(){g=e.TimingMOJO,h=e.Buffer,i=e.Audio},e.prototype=c.Create({_init:function(a,c){var d=this,e=b.querySelector(a),g=e.getBoundingClientRect(),h=c.width||g.width,i=c.height||g.height,j=f(h,i),k=j.getContext("2d");k.webkitImageSmoothingEnabled=!1,e.appendChild(j),d.width=h,d.height=i,d.canvas=j,d.context=k,d.videoContainer=e},load:function(a,b){var c=this;if(c.url=a||c.url,c.bufferOptions=c.bufferOptions||b,c.url){var d=new e.Buffer(c.url,c.bufferOptions).once("JSONResponse videoLoaded",c).when("framesetLoaded framesetComplete bufferProgress bufferReady",c);c.when([o,m],c).when(k,d).once("abort",d),c.set(l,1)}},handleMOJO:function(a){var b,c,d,e,f,g,h,i=this,o=arguments,q=i.queue;switch(a.type){case"set":b=o[1],b===l&&(c=j[i[b]],i.happen(b,[c,i[b]]));break;case"timing":i._timing.apply(i,o);break;case"videoLoaded":i.set(l,3);break;case m:i.stop(),console.log(i);break;case"JSONResponse":g=o[1],i.duration=g,i.set(l,1);break;case"bufferProgress":h=o[1],i.happen(n,h);break;case"bufferReady":i.readyState<2&&i.set(l,2);break;case"framesetLoaded":d=o[1],f=o[2],q[f]=d;break;case"framesetComplete":if(d=o[1],e=i.index,d===q[e]){q[e]=null,e++,i.happen(k,d);var r=Math.round(i.elapsed/1e3);i.happen(p,[r,i.duration])}i.index=e}},_timing:function(a,b){var c=this;if(c.playing){var d=c.index,e=c.queue,f=c.queue[d];if(!f)return void(e.length===c.duration?c.happen(m):c.readyState>1&&c.set(l,1));var g=f.requestFrame(b);g&&(c.frameProgress=f.percent,c._paint(g))}},play:function(){var a=this;a[l]||a.load(),a.playing||(a.playing=!0,g.subscribe(a))},stop:function(){var a=this;a.index=0,a.frameProgress=0,a.playing=!1,a.destroy(),g.unsubscribe(a)},_paint:function(a){var b=this,c=b.context,d=b.width,e=b.height;c.clearRect(0,0,d,e),c.drawImage(a,0,0,d,e)},destroy:function(){var a=this;a.queue=[],a.duration=null,a.happen("abort"),a.set(l,0),a.dispel(d())}}),e}(Object,document,MOJO),InlineVideo.TimingMOJO=function(a,b,c){function d(){var c=this;c.shouldLoop=!1,b.Construct(c),a.defineProperty(c,f,{get:function(){return(c.handlers[e]||[]).length}}),c.step=c._step.bind(c)}var e="timing",f="subscribers";return d.prototype=b.Create({subscribe:function(a){var b=this;b.when(e,a),b.shouldLoop||b._start()},unsubscribe:function(a){var b=this;b.dispel(e,a)},_start:function(){var a=this;a.shouldLoop=!0,c(a.step)},_step:function(a){var b=this;b.happen(e,a),b[f]<1?b.shouldLoop=!1:b.shouldLoop&&c(b.step)}}),new d}(Object,MOJO,requestAnimationFrame),InlineVideo.Audio=function(a,b){function c(a){var b=this;b.url=a}var d="prototype";return c[d]=b.Create({handleMOJO:function(a){a.type}}),c}(Object,MOJO),InlineVideo.Frameset=function(a,b,c){function d(b,d,e,f){var g=this;g.fps=f.length,g.mspf=1e3/g.fps,g.frames=[],c.Construct(g),a.defineProperties(g,{count:{get:function(){return g.frames.length}},elapsed:{get:function(){return g.time-g.startTime}},frame:{get:function(){return Math.ceil(g.elapsed/g.mspf)}},percent:{get:function(){return g.elapsed/1e3}},complete:{get:function(){return g.frame===g.count}}}),g.load=g.load.bind(g,d+e,f,b),g.reset()}function e(a,c){return new b(function(b){var d=new Image;d.onload=function(){c(d),b()},d.src=a+"?r="+Date.now()})}return d.prototype=c.Create({load:function(a,c){var d=this,f=d.frames,g=[];c.forEach(function(b,c){b&&(b=a+b,g.push(e(b,function(a){f[c]=a})))}),b.all(g).then(function(){d.happen("framesetLoaded")})},destroy:function(){var a=this;return console.log(a.handlers),a},reset:function(){var a=this;return a.time=0,a.startTime=0,a.lastFrame=null,a},requestFrame:function(a){var b=this;b.startTime=b.startTime||a,b.time=a;var c=b.frame;return c>b.lastFrame?(b.lastFrame=c,b.frames[c]):(b.complete&&b.happen("framesetComplete"),!1)}}),d}(Object,Promise,MOJO),InlineVideo.Buffer=function(a,b,c){function d(c,d){var e=this;e.min=1,e.range=2,e.queue=[],e.loading=[],e.count=0,e.loadCount=0,b.Each(d,function(a,b){e[b]=a}),e.max=e.min+e.range,b.Construct(e),a.defineProperties(e,{percent:{get:function(){return e.loadCount/e.count}},ready:{get:function(){return e.loadCount>=e.min}},loaded:{get:function(){return e.loadCount===e.count}}}),e._getManifest(c,function(a){var b=e.min;e.count=a,e.min=b>a?a:b,e.happen("JSONResponse",a),e.load()})}function e(a,b){b=b||function(){};var c=new XMLHttpRequest;f(c,"load",function(){var a=JSON.parse(c.response);b(a)}),c.open("get",a,!0),c.send()}function f(a,b,c){a.addEventListener(b,c)}var g="prototype",h=c.Frameset;return d[g]=b.Create({_getManifest:function(a,b){var c=this;e(a,function(a){console.log(a);var d=a.origin,e=a.path,f=a.frames,g=f.length;c.queue=f.map(function(a,b){var f=new h(b,d,e,a);return f.when("framesetComplete",f,c).once("framesetLoaded",[f,b],c)}),b(g)})},load:function(){for(var a,b=this,c=b.max,d=b.queue,e=b.loading;e.length<c&&d.length>0;)a=d.shift(),e.push(a),a.load()},handleMOJO:function(a){var b,c,d,e=this,f=arguments;switch(a.type){case"abort":e.happen("bufferProgress",0),e.dispel(),e.queue.forEach(function(a){a.dispel()});break;case"coreProgress":d=e.loading,b=f[1],c=d.indexOf(b),d.splice(c,1),e.loaded||e.load();break;case"framesetLoaded":b=f[1],c=f[2],e.loadCount++,e.happen("framesetLoaded",[b,c]),e.happen("bufferProgress",e.percent),e.ready&&e.happen("bufferReady"),e.loaded&&e.happen("videoLoaded");break;case"framesetComplete":b=f[1],e.happen("framesetComplete",b)}}}),d}(Object,MOJO,InlineVideo),function(a){a.Init()}(InlineVideo);